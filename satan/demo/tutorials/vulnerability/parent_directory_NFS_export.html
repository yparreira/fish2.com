<HTML>
<HEAD>
<TITLE>Tutorial - Parent directory NFS exports</TITLE>
<LINK REV="made" HREF="mailto:satan@fish.com">
</HEAD>
<BODY>

<H1><IMG SRC="../../images/satan.gif">Parent directory NFS exports</H1>

<HR>

<H3>Summary</H3>

Access to parents of NFS exported directories

<H3>Impact</H3>

NFS export restrictions can be bypassed

<H3>Background</H3>

The NFS (Network File System) provides a means to transparently share
file systems between system of different types. File systems are often
shared as a whole. For example, a UNIX file server exports a file
system by exporting that file system's root directory (and thus,
everything within that file system below the exported directory).

<p>

Instead of exporting complete file systems, an NFS server can be
configured to export file system subtrees. For example, a UNIX file
server exports a directory somewhere in the middle of a file system
(and thus, everything within that file system below the exported
directory).

<p>

Whenever an NFS client wants to access a remote file system for the
first time, it first needs to obtain a file (directory, etc.) handle
within the exported directory tree.  To this end, the client host sends
a mount request to the server's mount daemon.  The mount daemon knows
what is being exported. When the mount daemon grants access, it sends a
file (directory, etc.) handle back to the NFS client.

<H3>The problem</H3>

Some NFS servers do not really know what subtree of a file system is
being exported. Given a file handle for an exported subdirectory, a
malicious NFS client can access its parent directory by asking the NFS
server the file handle for "..", and so on, up to the root directory of
that file system.  Since the malicious client can acquire the file
handle of the file system root directory, it is just as if the server
is exporting the complete file system instead of just a subtree of it.

<H3>Fix</H3>

The fix is to make the NFS server code aware of what file system
subtrees are actually being exported.  This requires non-trivial
changes to the NFS server software, typically something that only your
vendor can do.

<H3>Workaround</H3>

When your NFS server allows access to parents of exported directories,
avoid exporting subtrees of file systems. Instead, arrange your file
systems such that you export only complete file systems.

<H3>Other tips</H3>

<ul>

<li>See also Leendert van Doorn's <a
href="ftp://coast.cs.purdue.edu/pub/tools/unix/nfsbug">nfsbug</a> tool
for a more extensive test of common NFS server flaws.

</ul>
</BODY>
</HTML>
